### ✍️ Tangxt ⏳ 2022-03-23 🏷️ 小程序

# 04-HYMusic ⾳乐⾸⻚搭建和开发

1）掌握其他知识点补充

💡：MV 视频可能播放不了？

有些服务器会做请求源验证

![请求源验证](assets/img/2022-03-23-12-08-34.png)

💡：小程序里自定义组件，给属性的默认值是用`value`，而不是 Vue 里边的`default`

![defalut](assets/img/2022-03-23-12-11-09.png)

💡：`setData`是同步的还是异步的？是同步或者异步的，对于我们开发者而言这很重要吗？

![setData](assets/img/2022-03-23-12-16-02.png)

小程序的`setData`：

- 更新`data`时是同步的 -> 优点 -> 可以立刻拿到最新最正确的值
- 把数据渲染到页面时是异步的

![setData](assets/img/2022-03-23-12-32-57.png)

react 设计成异步的是，是让`data`永远和页面显示的数据是保持一致的，并且传递给子组件的数据也是永远保持一致的！

> react 想要拿到最新数据 -> `setState`可以接收一个回调，等页面更新了就会拿到最新的值

而小程序则不同了，老师不喜欢小程序的这种设计方案，因为调试不方便

> 老师讲课的习惯 -> 喜欢把其他技术里边的知识拿来和正在讲的这个知识进行对比，比如讲 JS，就会看看 Vue、React 是怎样的，讲小程序，就会看看 Vue、React 是怎样的 -> 对比一下，看看不同的知识之间到底有什么联系或者有什么样的不同，又或者这种做法有啥优点，有啥缺点…… -> 经常性地对比来看，就这样，逐渐地你就能形成自己的思想了

![setState](assets/img/2022-03-23-16-19-17.png)

2）掌握音乐界面-轮播图的细节处理

💡：优化：轮播图的边缘是有间距的

给间距有两个思路：

1. 单独给`swiper`的左右两边一个`padding`就得了
2. 给整个页面加左右两个间距 -> 毕竟其它部分也要间距

![间距](assets/img/2022-03-23-16-25-38.png)

选择第二种：

![第二种](assets/img/2022-03-23-16-38-22.png)

![第二种](assets/img/2022-03-23-16-40-40.png)

💡：优化：整个页面有间距了，但搜索框不需要有间距

![间距](assets/img/2022-03-23-16-36-12.png)

去掉默认间距：

![间距](assets/img/2022-03-23-16-45-03.png)

💡：优化：给轮播图增加圆角边框

![圆角](assets/img/2022-03-23-16-46-27.png)

给谁加圆角？图片？还是`swiper`？

显然是`swiper`

![swiper](assets/img/2022-03-23-17-09-05.png)

> 图片超出圆角边框范围了，那么那部分就得隐藏掉，不然圆角无法显示出来，会被图片给遮住

如果你发现左上角没有圆角，那么这是模拟器的问题，不是你写的这个代码有问题，你在真机调试上，是不会有这个问题的！

当然，有些手机系统，是不会显示圆角的，我们知道小程序的页面渲染是手机系统提供的 webview，而它的 webview 不支持`border-raduis`，也就是针对 HTML 的渲染有些地方不支持。我们在做 h5 开发时，也会时常遇到这样的适配问题

![适配](assets/img/2022-03-23-17-16-21.png)

3）掌握音乐页面-封装 Header 组件和插槽使用

> 只要是技术上的问题，都会有对应的解决方案 -> 老师讲了很多小问题，有些小问题挺难解决的，比如刚刚那个`transform: translateY(0);`的添加，但这终归都会有解决方案（查 Stack Overflow 或者 Issues） -> 有时你会遇到基础库的问题，但你不要就这样认为，这个问题无法解决了，其实还是可以解决的 -> 小程序不支持的功能，还是有其它途径可以实现这个功能的

💡：做什么？

![做什么](assets/img/2022-03-23-18-47-01.png)

我们要完成两部分内容：

1. Header 组件封装 -> 涉及插槽的使用 -> 如何给插槽设置默认值
   1. 小程序不支持给插槽设置默认值，但我们可以通过别的方案来设置 -> 有些功能我们特别想用，但小程序不支持，而且这些功能实现起来也非常简单，更何况在 17、18 年就提出来了，到现在 2022 年了，这简单的功能还是不支持
   2. 老师会提供一种很优雅的方案来实现给插槽设置默认值
2. 多个页面之间如何共享数据 -> 小程序提供的方案：`app.js`，无法响应式 -> 用其它共享数据方案，可以做到响应式
   1. 音乐首页：歌曲推荐的列表数据
   2. 搜索页面：也有歌曲推荐的列表数据

💡：封装`Header`组件

为啥要封装？ -> 很多个地方都会用到 -> 有些地方标题不同，有些地方没有「更多」这样的文本 -> 我们要封装的更通用一些

1. 创建一个`area-header`组件 -> 放在`components`里边
2. 定义`wxml`、给样式、给属性
   1. 涉及到图标 -> 可以用 vant 组件库，但没必要，用图片就好了
3. 使用组件
   1. 注册组件

`wxml`：

![wxml](assets/img/2022-03-23-19-04-38.png)

效果：

![插槽](assets/img/2022-03-23-19-03-58.png)

---

是否显示右边？ -> 添加`showRight`属性，默认是显示的

![右边](assets/img/2022-03-23-19-09-57.png)

你在使用时，给个`false`值就行了：

![false](assets/img/2022-03-23-19-07-54.png)

---

使用插槽，指定你想要的右边部分

小程序做不到这样：

![插槽](assets/img/2022-03-23-19-13-29.png)

我们的需求是：给插槽内容，那就显示给的内容，不给插槽内容，那就显示组件默认给的

一种很笨的方案，用 JS 来控制显示和隐藏：

![方案一](assets/img/2022-03-23-19-20-09.png)

对使用这个组件的开发者而言，这种体验很不好 -> 每次写插槽内容都得传入那个`showMore`属性

另一种方案，用 CSS：

使用`empty`这个伪类，它可以判断一个组件的子组件是否为空，也就是一个元素是否有子元素（即便你是个回车空白字符，这也代表没有子元素）

![方案二](assets/img/2022-03-23-19-32-09.png)

这个方案好很多，非常方便，不用在 JS 里边定义一个个属性了，使用者也不用写一些很繁琐的属性了，比如`showMore`属性

> [Demo](https://github.com/ppambler/QQMusic/commit/4b5e5b2)

4）




