### âœï¸ Tangxt â³ 2022-03-23 ðŸ·ï¸ å°ç¨‹åº

# 04-HYMusic â¾³ä¹â¾¸â»šæ­å»ºå’Œå¼€å‘

1ï¼‰æŽŒæ¡å…¶ä»–çŸ¥è¯†ç‚¹è¡¥å……

ðŸ’¡ï¼šMV è§†é¢‘å¯èƒ½æ’­æ”¾ä¸äº†ï¼Ÿ

æœ‰äº›æœåŠ¡å™¨ä¼šåšè¯·æ±‚æºéªŒè¯

![è¯·æ±‚æºéªŒè¯](assets/img/2022-03-23-12-08-34.png)

ðŸ’¡ï¼šå°ç¨‹åºé‡Œè‡ªå®šä¹‰ç»„ä»¶ï¼Œç»™å±žæ€§çš„é»˜è®¤å€¼æ˜¯ç”¨`value`ï¼Œè€Œä¸æ˜¯ Vue é‡Œè¾¹çš„`default`

![defalut](assets/img/2022-03-23-12-11-09.png)

ðŸ’¡ï¼š`setData`æ˜¯åŒæ­¥çš„è¿˜æ˜¯å¼‚æ­¥çš„ï¼Ÿæ˜¯åŒæ­¥æˆ–è€…å¼‚æ­¥çš„ï¼Œå¯¹äºŽæˆ‘ä»¬å¼€å‘è€…è€Œè¨€è¿™å¾ˆé‡è¦å—ï¼Ÿ

![setData](assets/img/2022-03-23-12-16-02.png)

å°ç¨‹åºçš„`setData`ï¼š

- æ›´æ–°`data`æ—¶æ˜¯åŒæ­¥çš„ -> ä¼˜ç‚¹ -> å¯ä»¥ç«‹åˆ»æ‹¿åˆ°æœ€æ–°æœ€æ­£ç¡®çš„å€¼
- æŠŠæ•°æ®æ¸²æŸ“åˆ°é¡µé¢æ—¶æ˜¯å¼‚æ­¥çš„

![setData](assets/img/2022-03-23-12-32-57.png)

react è®¾è®¡æˆå¼‚æ­¥çš„æ˜¯ï¼Œæ˜¯è®©`data`æ°¸è¿œå’Œé¡µé¢æ˜¾ç¤ºçš„æ•°æ®æ˜¯ä¿æŒä¸€è‡´çš„ï¼Œå¹¶ä¸”ä¼ é€’ç»™å­ç»„ä»¶çš„æ•°æ®ä¹Ÿæ˜¯æ°¸è¿œä¿æŒä¸€è‡´çš„ï¼

> react æƒ³è¦æ‹¿åˆ°æœ€æ–°æ•°æ® -> `setState`å¯ä»¥æŽ¥æ”¶ä¸€ä¸ªå›žè°ƒï¼Œç­‰é¡µé¢æ›´æ–°äº†å°±ä¼šæ‹¿åˆ°æœ€æ–°çš„å€¼

è€Œå°ç¨‹åºåˆ™ä¸åŒäº†ï¼Œè€å¸ˆä¸å–œæ¬¢å°ç¨‹åºçš„è¿™ç§è®¾è®¡æ–¹æ¡ˆï¼Œå› ä¸ºè°ƒè¯•ä¸æ–¹ä¾¿

> è€å¸ˆè®²è¯¾çš„ä¹ æƒ¯ -> å–œæ¬¢æŠŠå…¶ä»–æŠ€æœ¯é‡Œè¾¹çš„çŸ¥è¯†æ‹¿æ¥å’Œæ­£åœ¨è®²çš„è¿™ä¸ªçŸ¥è¯†è¿›è¡Œå¯¹æ¯”ï¼Œæ¯”å¦‚è®² JSï¼Œå°±ä¼šçœ‹çœ‹ Vueã€React æ˜¯æ€Žæ ·çš„ï¼Œè®²å°ç¨‹åºï¼Œå°±ä¼šçœ‹çœ‹ Vueã€React æ˜¯æ€Žæ ·çš„ -> å¯¹æ¯”ä¸€ä¸‹ï¼Œçœ‹çœ‹ä¸åŒçš„çŸ¥è¯†ä¹‹é—´åˆ°åº•æœ‰ä»€ä¹ˆè”ç³»æˆ–è€…æœ‰ä»€ä¹ˆæ ·çš„ä¸åŒï¼Œåˆæˆ–è€…è¿™ç§åšæ³•æœ‰å•¥ä¼˜ç‚¹ï¼Œæœ‰å•¥ç¼ºç‚¹â€¦â€¦ -> ç»å¸¸æ€§åœ°å¯¹æ¯”æ¥çœ‹ï¼Œå°±è¿™æ ·ï¼Œé€æ¸åœ°ä½ å°±èƒ½å½¢æˆè‡ªå·±çš„æ€æƒ³äº†

![setState](assets/img/2022-03-23-16-19-17.png)

2ï¼‰æŽŒæ¡éŸ³ä¹ç•Œé¢-è½®æ’­å›¾çš„ç»†èŠ‚å¤„ç†

ðŸ’¡ï¼šä¼˜åŒ–ï¼šè½®æ’­å›¾çš„è¾¹ç¼˜æ˜¯æœ‰é—´è·çš„

ç»™é—´è·æœ‰ä¸¤ä¸ªæ€è·¯ï¼š

1. å•ç‹¬ç»™`swiper`çš„å·¦å³ä¸¤è¾¹ä¸€ä¸ª`padding`å°±å¾—äº†
2. ç»™æ•´ä¸ªé¡µé¢åŠ å·¦å³ä¸¤ä¸ªé—´è· -> æ¯•ç«Ÿå…¶å®ƒéƒ¨åˆ†ä¹Ÿè¦é—´è·

![é—´è·](assets/img/2022-03-23-16-25-38.png)

é€‰æ‹©ç¬¬äºŒç§ï¼š

![ç¬¬äºŒç§](assets/img/2022-03-23-16-38-22.png)

![ç¬¬äºŒç§](assets/img/2022-03-23-16-40-40.png)

ðŸ’¡ï¼šä¼˜åŒ–ï¼šæ•´ä¸ªé¡µé¢æœ‰é—´è·äº†ï¼Œä½†æœç´¢æ¡†ä¸éœ€è¦æœ‰é—´è·

![é—´è·](assets/img/2022-03-23-16-36-12.png)

åŽ»æŽ‰é»˜è®¤é—´è·ï¼š

![é—´è·](assets/img/2022-03-23-16-45-03.png)

ðŸ’¡ï¼šä¼˜åŒ–ï¼šç»™è½®æ’­å›¾å¢žåŠ åœ†è§’è¾¹æ¡†

![åœ†è§’](assets/img/2022-03-23-16-46-27.png)

ç»™è°åŠ åœ†è§’ï¼Ÿå›¾ç‰‡ï¼Ÿè¿˜æ˜¯`swiper`ï¼Ÿ

æ˜¾ç„¶æ˜¯`swiper`

![swiper](assets/img/2022-03-23-17-09-05.png)

> å›¾ç‰‡è¶…å‡ºåœ†è§’è¾¹æ¡†èŒƒå›´äº†ï¼Œé‚£ä¹ˆé‚£éƒ¨åˆ†å°±å¾—éšè—æŽ‰ï¼Œä¸ç„¶åœ†è§’æ— æ³•æ˜¾ç¤ºå‡ºæ¥ï¼Œä¼šè¢«å›¾ç‰‡ç»™é®ä½

å¦‚æžœä½ å‘çŽ°å·¦ä¸Šè§’æ²¡æœ‰åœ†è§’ï¼Œé‚£ä¹ˆè¿™æ˜¯æ¨¡æ‹Ÿå™¨çš„é—®é¢˜ï¼Œä¸æ˜¯ä½ å†™çš„è¿™ä¸ªä»£ç æœ‰é—®é¢˜ï¼Œä½ åœ¨çœŸæœºè°ƒè¯•ä¸Šï¼Œæ˜¯ä¸ä¼šæœ‰è¿™ä¸ªé—®é¢˜çš„ï¼

å½“ç„¶ï¼Œæœ‰äº›æ‰‹æœºç³»ç»Ÿï¼Œæ˜¯ä¸ä¼šæ˜¾ç¤ºåœ†è§’çš„ï¼Œæˆ‘ä»¬çŸ¥é“å°ç¨‹åºçš„é¡µé¢æ¸²æŸ“æ˜¯æ‰‹æœºç³»ç»Ÿæä¾›çš„ webviewï¼Œè€Œå®ƒçš„ webview ä¸æ”¯æŒ`border-raduis`ï¼Œä¹Ÿå°±æ˜¯é’ˆå¯¹ HTML çš„æ¸²æŸ“æœ‰äº›åœ°æ–¹ä¸æ”¯æŒã€‚æˆ‘ä»¬åœ¨åš h5 å¼€å‘æ—¶ï¼Œä¹Ÿä¼šæ—¶å¸¸é‡åˆ°è¿™æ ·çš„é€‚é…é—®é¢˜

![é€‚é…](assets/img/2022-03-23-17-16-21.png)

3ï¼‰æŽŒæ¡éŸ³ä¹é¡µé¢-å°è£… Header ç»„ä»¶å’Œæ’æ§½ä½¿ç”¨

> åªè¦æ˜¯æŠ€æœ¯ä¸Šçš„é—®é¢˜ï¼Œéƒ½ä¼šæœ‰å¯¹åº”çš„è§£å†³æ–¹æ¡ˆ -> è€å¸ˆè®²äº†å¾ˆå¤šå°é—®é¢˜ï¼Œæœ‰äº›å°é—®é¢˜æŒºéš¾è§£å†³çš„ï¼Œæ¯”å¦‚åˆšåˆšé‚£ä¸ª`transform: translateY(0);`çš„æ·»åŠ ï¼Œä½†è¿™ç»ˆå½’éƒ½ä¼šæœ‰è§£å†³æ–¹æ¡ˆï¼ˆæŸ¥ Stack Overflow æˆ–è€… Issuesï¼‰ -> æœ‰æ—¶ä½ ä¼šé‡åˆ°åŸºç¡€åº“çš„é—®é¢˜ï¼Œä½†ä½ ä¸è¦å°±è¿™æ ·è®¤ä¸ºï¼Œè¿™ä¸ªé—®é¢˜æ— æ³•è§£å†³äº†ï¼Œå…¶å®žè¿˜æ˜¯å¯ä»¥è§£å†³çš„ -> å°ç¨‹åºä¸æ”¯æŒçš„åŠŸèƒ½ï¼Œè¿˜æ˜¯æœ‰å…¶å®ƒé€”å¾„å¯ä»¥å®žçŽ°è¿™ä¸ªåŠŸèƒ½çš„

ðŸ’¡ï¼šåšä»€ä¹ˆï¼Ÿ

![åšä»€ä¹ˆ](assets/img/2022-03-23-18-47-01.png)

æˆ‘ä»¬è¦å®Œæˆä¸¤éƒ¨åˆ†å†…å®¹ï¼š

1. Header ç»„ä»¶å°è£… -> æ¶‰åŠæ’æ§½çš„ä½¿ç”¨ -> å¦‚ä½•ç»™æ’æ§½è®¾ç½®é»˜è®¤å€¼
   1. å°ç¨‹åºä¸æ”¯æŒç»™æ’æ§½è®¾ç½®é»˜è®¤å€¼ï¼Œä½†æˆ‘ä»¬å¯ä»¥é€šè¿‡åˆ«çš„æ–¹æ¡ˆæ¥è®¾ç½® -> æœ‰äº›åŠŸèƒ½æˆ‘ä»¬ç‰¹åˆ«æƒ³ç”¨ï¼Œä½†å°ç¨‹åºä¸æ”¯æŒï¼Œè€Œä¸”è¿™äº›åŠŸèƒ½å®žçŽ°èµ·æ¥ä¹Ÿéžå¸¸ç®€å•ï¼Œæ›´ä½•å†µåœ¨ 17ã€18 å¹´å°±æå‡ºæ¥äº†ï¼Œåˆ°çŽ°åœ¨ 2022 å¹´äº†ï¼Œè¿™ç®€å•çš„åŠŸèƒ½è¿˜æ˜¯ä¸æ”¯æŒ
   2. è€å¸ˆä¼šæä¾›ä¸€ç§å¾ˆä¼˜é›…çš„æ–¹æ¡ˆæ¥å®žçŽ°ç»™æ’æ§½è®¾ç½®é»˜è®¤å€¼
2. å¤šä¸ªé¡µé¢ä¹‹é—´å¦‚ä½•å…±äº«æ•°æ® -> å°ç¨‹åºæä¾›çš„æ–¹æ¡ˆï¼š`app.js`ï¼Œæ— æ³•å“åº”å¼ -> ç”¨å…¶å®ƒå…±äº«æ•°æ®æ–¹æ¡ˆï¼Œå¯ä»¥åšåˆ°å“åº”å¼
   1. éŸ³ä¹é¦–é¡µï¼šæ­Œæ›²æŽ¨èçš„åˆ—è¡¨æ•°æ®
   2. æœç´¢é¡µé¢ï¼šä¹Ÿæœ‰æ­Œæ›²æŽ¨èçš„åˆ—è¡¨æ•°æ®

ðŸ’¡ï¼šå°è£…`Header`ç»„ä»¶

ä¸ºå•¥è¦å°è£…ï¼Ÿ -> å¾ˆå¤šä¸ªåœ°æ–¹éƒ½ä¼šç”¨åˆ° -> æœ‰äº›åœ°æ–¹æ ‡é¢˜ä¸åŒï¼Œæœ‰äº›åœ°æ–¹æ²¡æœ‰ã€Œæ›´å¤šã€è¿™æ ·çš„æ–‡æœ¬ -> æˆ‘ä»¬è¦å°è£…çš„æ›´é€šç”¨ä¸€äº›

1. åˆ›å»ºä¸€ä¸ª`area-header`ç»„ä»¶ -> æ”¾åœ¨`components`é‡Œè¾¹
2. å®šä¹‰`wxml`ã€ç»™æ ·å¼ã€ç»™å±žæ€§
   1. æ¶‰åŠåˆ°å›¾æ ‡ -> å¯ä»¥ç”¨ vant ç»„ä»¶åº“ï¼Œä½†æ²¡å¿…è¦ï¼Œç”¨å›¾ç‰‡å°±å¥½äº†
3. ä½¿ç”¨ç»„ä»¶
   1. æ³¨å†Œç»„ä»¶

`wxml`ï¼š

![wxml](assets/img/2022-03-23-19-04-38.png)

æ•ˆæžœï¼š

![æ’æ§½](assets/img/2022-03-23-19-03-58.png)

---

æ˜¯å¦æ˜¾ç¤ºå³è¾¹ï¼Ÿ -> æ·»åŠ `showRight`å±žæ€§ï¼Œé»˜è®¤æ˜¯æ˜¾ç¤ºçš„

![å³è¾¹](assets/img/2022-03-23-19-09-57.png)

ä½ åœ¨ä½¿ç”¨æ—¶ï¼Œç»™ä¸ª`false`å€¼å°±è¡Œäº†ï¼š

![false](assets/img/2022-03-23-19-07-54.png)

---

ä½¿ç”¨æ’æ§½ï¼ŒæŒ‡å®šä½ æƒ³è¦çš„å³è¾¹éƒ¨åˆ†

å°ç¨‹åºåšä¸åˆ°è¿™æ ·ï¼š

![æ’æ§½](assets/img/2022-03-23-19-13-29.png)

æˆ‘ä»¬çš„éœ€æ±‚æ˜¯ï¼šç»™æ’æ§½å†…å®¹ï¼Œé‚£å°±æ˜¾ç¤ºç»™çš„å†…å®¹ï¼Œä¸ç»™æ’æ§½å†…å®¹ï¼Œé‚£å°±æ˜¾ç¤ºç»„ä»¶é»˜è®¤ç»™çš„

ä¸€ç§å¾ˆç¬¨çš„æ–¹æ¡ˆï¼Œç”¨ JS æ¥æŽ§åˆ¶æ˜¾ç¤ºå’Œéšè—ï¼š

![æ–¹æ¡ˆä¸€](assets/img/2022-03-23-19-20-09.png)

å¯¹ä½¿ç”¨è¿™ä¸ªç»„ä»¶çš„å¼€å‘è€…è€Œè¨€ï¼Œè¿™ç§ä½“éªŒå¾ˆä¸å¥½ -> æ¯æ¬¡å†™æ’æ§½å†…å®¹éƒ½å¾—ä¼ å…¥é‚£ä¸ª`showMore`å±žæ€§

å¦ä¸€ç§æ–¹æ¡ˆï¼Œç”¨ CSSï¼š

ä½¿ç”¨`empty`è¿™ä¸ªä¼ªç±»ï¼Œå®ƒå¯ä»¥åˆ¤æ–­ä¸€ä¸ªç»„ä»¶çš„å­ç»„ä»¶æ˜¯å¦ä¸ºç©ºï¼Œä¹Ÿå°±æ˜¯ä¸€ä¸ªå…ƒç´ æ˜¯å¦æœ‰å­å…ƒç´ ï¼ˆå³ä¾¿ä½ æ˜¯ä¸ªå›žè½¦ç©ºç™½å­—ç¬¦ï¼Œè¿™ä¹Ÿä»£è¡¨æ²¡æœ‰å­å…ƒç´ ï¼‰

![æ–¹æ¡ˆäºŒ](assets/img/2022-03-23-19-32-09.png)

è¿™ä¸ªæ–¹æ¡ˆå¥½å¾ˆå¤šï¼Œéžå¸¸æ–¹ä¾¿ï¼Œä¸ç”¨åœ¨ JS é‡Œè¾¹å®šä¹‰ä¸€ä¸ªä¸ªå±žæ€§äº†ï¼Œä½¿ç”¨è€…ä¹Ÿä¸ç”¨å†™ä¸€äº›å¾ˆç¹ççš„å±žæ€§äº†ï¼Œæ¯”å¦‚`showMore`å±žæ€§

> CSS å¾ˆé‡è¦ï¼Œé‡åˆ°ä¸€äº›é—®é¢˜æ—¶ï¼Œç”¨ CSS è§£å†³èµ·æ¥è¦æ›´æ–¹ä¾¿ä¸€äº› -> ç³»ç»Ÿè¯¾ä¼šè®² CSSï¼ŒB ç«™ä¹Ÿæœ‰è€å¸ˆè®² CSS çš„è§†é¢‘

> [Demo](https://github.com/ppambler/QQMusic/commit/4b5e5b2)

4ï¼‰æŽŒæ¡å°ç¨‹åºçŠ¶æ€ç®¡ç†æ–¹æ¡ˆè§£æž

ðŸ’¡ï¼šå°ç¨‹åºå¤šé¡µé¢çŠ¶æ€ç®¡ç†

![çŠ¶æ€ç®¡ç†](assets/img/2022-03-23-20-56-43.png)

é¢ä¸´é—®é¢˜ï¼š

- å¤šé¡µé¢å…±äº«æ•°æ®
- å¤šé¡µé¢äº‹ä»¶ä¼ é€’

é¡µé¢è”ç³»ï¼š

- ä¸€ä¸ªé¡µé¢ç”±å¦ä¸€ä¸ªé¡µé¢æŽ¨å‡ºæ¥çš„ -> è”ç³»ç´§å¯† -> æ•°æ®æ²Ÿé€šå’Œäº‹ä»¶æ²Ÿé€šå¾ˆæ–¹ä¾¿
- ä¸€ä¸ªé¡µé¢å’Œå¦ä¸€ä¸ªé¡µé¢ -> ä¸å­˜åœ¨ç›´æŽ¥è”ç³» -> è·¨é¡µé¢ä¹‹é—´çš„äº‹ä»¶ä¼ é€’ï¼Œä¸€ä¸ªé¡µé¢æŠ›å‡ºäº‹ä»¶ï¼Œå…¶å®ƒé¡µé¢ç›‘å¬è¿™ä¸ªäº‹ä»¶ -> äºŽæ˜¯ï¼Œæœ‰äº†ä¸€äº›åº“ï¼Œæ¯”å¦‚`mitt`ï¼Œè¿™äº›åº“ä¹Ÿå«äº‹ä»¶æ€»çº¿ï¼ˆJS é«˜çº§è¯¾æœ‰æ‰‹å†™ï¼‰ -> è¿™äº›åº“ä¸€èˆ¬åªè´Ÿè´£å¸®åŠ©æˆ‘ä»¬ä¼ é€’äº‹ä»¶ï¼Œä¸ä¼šå¸®ä½ åŽ»ç®¡ç†ä¸€äº›çŠ¶æ€çš„

ä»€ä¹ˆå«ç®¡ç†çŠ¶æ€ï¼Ÿ

å°±æ˜¯æœ‰ä¸€ä¸ªæ•°æ®ä»“åº“ï¼Œæ¯ä¸ªé¡µé¢éƒ½èƒ½è®¿é—®è¿™ä¸ªä»“åº“ï¼ŒæŸä¸ªé¡µé¢ä¿®æ”¹äº†è¿™ä¸ªä»“åº“é‡Œè¾¹çš„æŸä¸ªæ•°æ®ï¼Œç”¨åˆ°è¿™ä¸ªæ•°æ®çš„é¡µé¢éƒ½ä¼šæœ‰ç›¸åº”çš„å“åº”å¼æ›´æ–°

å°ç¨‹åºçš„æ•°æ®å…±äº«æ–¹æ¡ˆï¼š

- åªæœ‰å…±äº«æ•°æ®
- æ²¡æœ‰å“åº”å¼ -> éœ€è¦æ–°æ•°æ®éœ€è¦é‡æ–°è°ƒç”¨å‡½æ•°æ‹¿ï¼Œå¯æ˜¯ä½ æ€Žä¹ˆçŸ¥é“æ•°æ®æ˜¯ä»€ä¹ˆæ—¶å€™æ›´æ–°å‘¢ï¼Ÿ

ç¬¬ä¸‰æ–¹æ–¹æ¡ˆï¼Ÿ -> ä¸€äº›åº“ä¼šæ”¹å˜äº†çš„å†™æ³•ï¼Œè®©ä½ çš„ä»£ç å’Œè¿™ä¸ªåº“è€¦åˆåº¦å¤ªé«˜ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œä½ ä¸ç”¨è¿™ä¸ªåº“ï¼Œä»£ç å°±å†™ä¸ä¸‹åŽ»äº†ï¼è¿˜æœ‰ä¸åˆ©äºŽå…¶ä»–äººçš„ç»´æŠ¤ï¼Œæ¯•ç«Ÿè¿™ä¸ªä»£ç å’Œå°ç¨‹åºå®˜æ–¹çš„ä»£ç å¾ˆä¸ç›¸åŒ -> é™¤æ­¤ä¹‹å¤–ï¼ŒåŸºç¡€åº“æ›´æ–°äº†ï¼Œè¿™ä¸ªåº“å¯èƒ½ä¸ç”¨äº†

è€å¸ˆåœ¨ç½‘ä¸Šæ²¡æœ‰æ‰¾åˆ°åˆé€‚çš„åº“

äºŽæ˜¯ï¼Œè€å¸ˆè‡ªä¸ªå†™äº†ä¸€ä¸ªåº“ -> è¿™ä¸ªåº“é€‚åˆå°ç¨‹åºï¼Œä¹Ÿé€‚åˆ Vue å’Œ React ç­‰ -> å­¦äº† JS é«˜çº§è¯¾ç¨‹ï¼Œè¿™æ ·çš„åº“å¾ˆå®¹æ˜“å†™å‡ºæ¥

ðŸ’¡ï¼šè¿™ä¸ªåº“æ˜¯å¦‚ä½•ä½¿ç”¨çš„ï¼Ÿåœ¨å°ç¨‹åºé‡Œè¾¹åˆæ˜¯å¦‚ä½•ä½¿ç”¨çš„ï¼Ÿ

> æ–‡æ¡£ï¼š[coderwhy/hy-event-store: An event-based global state management tool for vue, react, mini-program, ect.](https://github.com/coderwhy/hy-event-store)

è¿™ä¸ªåº“ä¸ä¾èµ–ä»»ä½•æ¡†æž¶ï¼Œæ˜¯ä¸ªç‹¬ç«‹çš„åº“

è¿™ä¸ªåº“æ˜¯åŸºäºŽäº‹ä»¶çš„çŠ¶æ€ç®¡ç†

- æœ‰äº‹ä»¶æ€»çº¿åŠŸèƒ½
- é€šè¿‡äº‹ä»¶å­˜å‚¨æ¥ç®¡ç†çŠ¶æ€

> åŽŸç†ï¼šäº‹ä»¶æ€»çº¿+å“åº”å¼

å®‰è£…ï¼š

``` bash
npm i hy-event-store
```

> `hy`æ˜¯å‰ç¼€ï¼Œæ¯•ç«Ÿå«`event-store`çš„åº“å¯èƒ½ä¼šå­˜åœ¨ï¼ŒåŠ ä¸Š`hy`å‰ç¼€ï¼Œä»¥é˜²å†²çª

![hy-event-store](assets/img/2022-03-24-18-25-50.png)

> API æ¨¡ä»¿ Vuexï¼Œæ¯•ç«Ÿ Vuex å¤§å®¶éƒ½ç†Ÿæ‚‰

ä½¿ç”¨ï¼š

ä»“åº“å­˜å‚¨çš„æ•°æ®åˆ†ä¸ºï¼š

- æœ¬åœ°æ•°æ® -> æœ¬åœ°å†™æ­»çš„æ•°æ®
- ç½‘ç»œæ•°æ® -> å‘è¯·æ±‚å¾—æ¥çš„æ•°æ® -> æ¶‰åŠ`actions`

å…¶å®ƒé¡µé¢è¦å…±äº«æ•°æ®ï¼š

- ç›‘å¬æŸä¸ªæ•°æ®`store.onState('name',(res) => {})`ï¼Œä¸€æ—¦è¿™ä¸ªæ•°æ®æ›´æ–°äº†ï¼Œå°±ä¼šè°ƒç”¨å›žè°ƒ -> é»˜è®¤ç¬¬ä¸€æ¬¡ç›‘å¬ï¼Œä¼šè§¦å‘ä¸€æ¬¡å›žè°ƒ
- ä¿®æ”¹å…±äº«æ•°æ®ï¼š`store.setState("name", "jack")`

å‘é€è¯·æ±‚èŽ·å–ç½‘ç»œæ•°æ®ï¼š

``` js
// åœ¨å…¥å£æ–‡ä»¶å†™
store.dispatch("getHomeDataAction", 123)
```

ä»£ç ï¼š

``` js
// src/main.js
const { HYEventStore } = require("hy-event-store")
const axios = require("axios")

// åˆ›å»º Store å¯¹è±¡
const store = new HYEventStore({
  state: {
    // æœ¬åœ°æ•°æ®
    name: "why",
    age: 18,
    // ç½‘ç»œæ•°æ®
    banners: [12, 23],
    recommends: []
  },
  actions: {
    // å‘é€ç½‘ç»œè¯·æ±‚
    getHomeDataAction(ctx, payload) {
      // ctx å¯ç”¨æ¥æ›´æ–°æ•°æ® -> ä¸åŒäºŽ this
      axios.get("http://123.207.32.32:8000/home/multidata").then(res => {
        ctx.banners = res.data.data.banner.list
        ctx.recommends = res.data.data.recommend.list
      })
    }
  }
})

// app å¯åŠ¨
store.dispatch("getHomeDataAction", 123)

// page1 é¡µé¢
// store.onState("name", (res) => {
//   console.log(res)
// })

store.onState("banners", (res) => {
  console.log("page1:", res)
})

// page2 é¡µé¢
// setTimeout(() => {
//   store.setState("name", "jack")
// }, 1000);
store.onState("banners", (res) => {
  console.log("page2:", res)
})
```

ç”¨`node`å¯åŠ¨è¿™ä¸ª`main.js`æ–‡ä»¶

> ç»™æˆ‘çš„æ„Ÿè§‰å°±æ˜¯å‘å¸ƒè®¢é˜…

> å»ºè®®ï¼šå¦‚æžœä½ æƒ³åœ¨ä½ çš„é¡¹ç›®é‡Œè¾¹ç”¨ä¸€äº›åŠŸèƒ½ï¼Œè€Œä½ åœ¨ç½‘ä¸Šæ‰¾ä¸åˆ°åˆé€‚çš„åº“ï¼Œå»ºè®®ä½ è‡ªå·±å†™ä¸€ä¸ªï¼Œæ¯•ç«Ÿç”¨äººå®¶çš„ï¼Œå¾ˆæœ‰å¯èƒ½ä¼šæœ‰å¤§é—®é¢˜ã€‚ -> è‡ªå·±å†™ä¸€ä¸ªå§ -> å‰äººæ ½æ ‘ï¼ŒåŽäººä¹˜å‡‰

çŠ¶æ€ç®¡ç†å¾ˆå¸¸è§ï¼Œä¸å•æ˜¯å°ç¨‹åºå¼€å‘ï¼ˆä¸€çº§ä¸€çº§è¿™æ ·ä¼ æ•°æ®å¾ˆç¹çï¼‰ï¼Œä½ æžå‰ç«¯å¼€å‘éƒ½ä¼šç”¨å¾—ä¸Šï¼

> è¿™ä¸ªåº“ï¼Œè€å¸ˆæ˜¯å¦‚ä½•å†™å‡ºæ¥çš„ï¼Ÿ -> JS æ°´å¹³æ‰Žå®ž + å¤šé˜…è¯»ä¼˜ç§€çš„æ¡†æž¶æºç 
> 
> å‚è€ƒ TJ -> TJ çœ‹äº†å¾ˆå¤šä¼˜ç§€åº“çš„æºç ï¼Œä¸æ­¢æ˜¯å‰ç«¯æ–¹é¢çš„ï¼ŒåŽç«¯æ–¹é¢çš„ä¹Ÿæœ‰ï¼Œä»–é€šè¿‡ä»Žè¿™äº›åº“å­¦åˆ°çš„ä¸œè¥¿ï¼Œé€ äº†å¾ˆå¤šè½®å­

![TJ](assets/img/2022-03-24-19-11-05.png)

> ä¸çœ‹ä¹¦ï¼Œä¸å¬è¯¾ -> æœ‰ç‚¹å¤©æ‰çš„æ„æ€â€¦â€¦

5ï¼‰æŽŒæ¡ EventStore å…±äº«æ•°æ®çš„ä½¿ç”¨

> å¯¹äºŽä¼˜ç§€çš„äººä¼¼ä¹Žéƒ½æ˜¯ï¼šå·²è¯†ä¹¾å¤å¤§ï¼ŒçŠ¹æ€œè‰æœ¨é’ -> æœ‰äº›äººçœ‹åˆ° React ç‰›é€¼ï¼Œå°±è§‰å¾— Vue ä¸å’‹æ»´ -> å…¶å®žå®ƒä»¬éƒ½æœ‰å„è‡ªç‹¬ç‰¹çš„ä¼˜ç§€ä¹‹å¤„

æ­Œæ›²æŽ¨èæ¥è‡ªçƒ­é—¨æ¦œå•ï¼š

![çƒ­é—¨æ¦œå•](assets/img/2022-03-24-21-19-23.png)

æŠŠèŽ·å–åˆ°çš„çƒ­é—¨æ¦œå•æ•°æ®æ”¾åˆ°`store`é‡Œè¾¹è¿›è¡Œå…±äº«

ðŸ’¡ï¼šåœ¨å°ç¨‹åºé‡Œè¾¹ä½¿ç”¨`hy-event-store`

åœ¨é¡¹ç›®æ ¹ç›®å½•é‡Œè¾¹ï¼š

``` bash
npm i hy-event-store
```

æž„å»º`npm`

åœ¨é¡¹ç›®æ ¹ç›®å½•æ——ä¸‹åˆ›å»ºä¸€ä¸ª`store`ç›®å½• -> ç”¨æ¥å­˜æ”¾å…±äº«æ•°æ® -> Vue é¡¹ç›®ä¹Ÿæ˜¯è¿™æ ·åšçš„

åˆ›å»º`ranking-store.js`ï¼š

![store](assets/img/2022-03-25-17-53-23.png)

å°ç¨‹åºçš„é¡¹ç›®å¹¶ä¸éœ€è¦æžå¾—å¤ªå¤æ‚ï¼Œæˆ‘ä»¬ç®€å•æžä¸€ä¸ª`store`æ–‡ä»¶å°±å¾—äº†

å®šä¹‰ä¸€ä¸ª`store`ï¼š

``` js
import { HYEventStore } from 'hy-event-store'

import { getRankings } from '../service/api_music'

const rankingStore = new HYEventStore({
  state: {
    hotRanking: {}
  },
  actions: {
    getRankingDataAction(ctx) {
      getRankings(1).then(res => {
        console.log(res)
        ctx.hotRanking = res.playlist
      })
    }
  }
})

export {
  rankingStore
}
```

å°è£…ç½‘ç»œè¯·æ±‚ APIï¼š

![API](assets/img/2022-03-25-17-58-45.png)

`store/index.js`çš„ä½œç”¨ -> ç”¨æ¥ç»Ÿä¸€å¯¼å‡º`store`ï¼ˆæ›´ä¼˜é›…çš„åšæ³•ï¼‰ï¼Œä¹Ÿå°±æ˜¯æžä¸€ä¸ªå‡ºå£æ¥ç»Ÿä¸€å¯¼å‡ºæ•°æ® -> ä¸ºå•¥`service`æ——ä¸‹çš„`index.js`ä¸è¿™æ ·æžï¼Ÿ -> å› ä¸ºå°è£…çš„ API å¤ªå¤šäº†ï¼Œéƒ½æ”¾åœ¨ä¸€ä¸ª`index.js`çš„è¯ï¼Œé‚£å°±å¤ªä¹±äº†ï¼Œè€Œ`store`çš„`index.js`ï¼Œå°±é‚£ä¹ˆå‡ ä¸ª`store`

![å¯¼å‡º store](assets/img/2022-03-25-18-11-06.png)

åœ¨`home-music`é¡µé¢çš„`onLoad`é‡Œè¾¹å‘èµ·è¯·æ±‚ï¼ŒèŽ·å–æ¥è‡ªç½‘ç»œä¸Šçš„å…±äº«æ•°æ®ï¼š

![è¯·æ±‚æ•°æ®](assets/img/2022-03-25-18-13-27.png)

çƒ­æœæ¦œçš„æ•°æ®åœ¨å“ªï¼Ÿ

![tracks](assets/img/2022-03-25-18-14-27.png)

æˆ‘ä»¬åœ¨éŸ³ä¹é¦–é¡µåªç»™å®ƒå±•ç¤º`6`æ¡ï¼Œè€Œç‚¹å‡»ã€Œæ›´å¤šã€è·³åˆ°å¦å¤–ä¸€ä¸ªé¡µé¢ï¼Œå°±ç»™å®ƒå±•ç¤º`200`æ¡æ•°æ®

![å…±äº«æ•°æ®](assets/img/2022-03-25-18-34-23.png)

è‡³æ­¤ï¼Œæ•°æ®è¯·æ±‚å’Œæ•°æ®å…±äº«å°±æžå®šäº† -> ä¸‹ä¸€æ­¥è¦åšçš„å°±æ˜¯æŠŠæ•°æ®å±•ç¤ºåˆ°é¡µé¢ä¸Š

> [Demo](https://github.com/ppambler/QQMusic/commit/1c9357a)

ðŸ’¡ï¼šæ¯ä¸ªé¡µé¢èŽ·å–åˆ°çš„`rankingStore`éƒ½æ˜¯åŒä¸€ä¸ªå¯¹è±¡

ä¸ºå•¥è¿™æ ·è¯´ï¼Ÿ -> `ranking-store.js`è¿™ä¸ªæ¨¡å—é‡Œè¾¹çš„ä»£ç åªä¼šæ‰§è¡Œä¸€æ¬¡ï¼Œè¿™æ„å‘³ç€å…¶å®ƒé¡µé¢æ‹¿åˆ°çš„å¯¼å…¥å¯¹è±¡éƒ½æ˜¯åŒä¸€ä¸ªå¯¹è±¡

âž¹ï¼š[æ¨¡å— (Module) ç®€ä»‹](https://zh.javascript.info/modules-intro)

6ï¼‰æŽŒæ¡éŸ³ä¹é¡µé¢-æŽ¨èæ­Œæ›²çš„å±•ç¤º

ðŸ’¡ï¼šä¸€ä¸ªå°å»ºè®®

![å»ºè®®](assets/img/2022-03-25-19-22-54.png)

ðŸ’¡ï¼šå°è£…ç»„ä»¶`song-item-v1`

![song-item-v1](assets/img/2022-03-25-20-11-56.png)

è¿™ä¸ª`>`å›¾æ ‡å¤§å°è·Ÿæ ‡é¢˜çš„`>`æ˜¯ä¸€è‡´çš„ï¼Œå‚ç…§ QQ éŸ³ä¹å¾®ä¿¡å°ç¨‹åºï¼Œä¹Ÿæ˜¯è¿™æ ·çš„

> [Demo](https://github.com/ppambler/QQMusic/commit/198e80a)
