### ✍️ Tangxt ⏳ 2022-03-28 🏷️ 小程序

# 06-HYMusic 搜索⻚和搜索功能开发

1）答疑

💡：事件总线什么时候用？

- 跨组件通信
- 跨页面通信

事件总线 -> 类似订阅发布模式 -> 相当于是一种事件传递

A `$emit` 一个事件，此时 B 组件还未创建，那么 B 组件能监听到这个事件吗？ -> 一般是不能的，除非你做了特殊处理的，比如老师写的那个库 EventStore，第一次监听事件，会自动触发一次回调！

💡：pnpm 是趋势吗？

现在很多项目在用它，但变成整体趋势还不好说，毕竟 npm 也在更新，也变得越来越好用了

总之，看后边发展情况就得了！

💡：音视频方向？

音视频未来会越来越好 -> 网速会越来越快（不管有没有 5G 都这样），再加上元宇宙，元宇宙如果火起来，那它内部对音视频这些东西也是要求很高的！ -> VR（目前 VR 眼镜分辨率低，体验不好，但这终归是未来的一种趋势，目前你想体验好点的话，得设备好+网速快）

💡：前端到高级了，是不是就不仅限于页面业务了？

是的 -> 业务你做多了的话，你会发现业务都差不多的

💡：bug 排查？

缩小范围 -> 定位到什么时候情况下会出现这个问题 -> 针对性解决这个问题

---

2）掌握跳转歌曲详情页-区分榜单

💡：做什么？

某个排行榜详情页：

![做](assets/img/2022-03-29-14-35-43.png)

某个歌单的详情页：

![做](assets/img/2022-03-29-14-36-31.png)

💡：怎么做？

这是我们要做的第一件事：

![怎么做](assets/img/2022-03-29-14-40-57.png)

💡：实现它？

先来完成榜单的详情页：

1. 谁要跳转？ -> 「更多」、榜单排行榜的整个区域
2. 在`pages`旗下，创建`detail-songs`页面

在哪儿处理事件？

组件吗？ -> 不是 -> 有两个「更多」，这两个更多的逻辑是不一样的 -> 所以我们不能在组件内部处理事件，而是让组件把这个事件发送出去

![更多](assets/img/2022-03-29-17-16-04.png)

![事件处理](assets/img/2022-03-29-18-08-50.png)

![发送事件](assets/img/2022-03-29-17-18-36.png)

![事件发送](assets/img/2022-03-29-17-20-25.png)

![事件监听](assets/img/2022-03-29-18-07-27.png)

> 以上是针对「热门榜」的监听处理 -> 也就是「推荐歌曲」的`更多`

💡：榜单的事件监听

![监听榜单](assets/img/2022-03-29-17-24-32.png)

有两种方法监听：

1. 直接在自定义组件写`bindtap`，不用在组件内部写`this.triggerEvent('click')` -> 内置组件（如`view`）可以用`bindtap`，自定义组件也可以直接用
2. 你也可以在自定义组件的`wxml`里边的`view`根标签监听这个`bindtap`事件，毕竟这是针对整个 Item 的监听，不是具体到某个图片的监听，然后在把事件`triggerEvent`出去

在这里我们选择第一种，因为这个`更多`的事件处理函数是一样的，为了方便日后维护和修改，我们选择第一种

![处理函数](assets/img/2022-03-29-17-33-56.png)

由于需要传递参数，我们对原先的处理函数里边的逻辑，提取成一个函数来调用：

![处理](assets/img/2022-03-29-18-51-58.png)

获取参数：

![处理](assets/img/2022-03-29-17-44-14.png)

在参数的处理方面，我们可以利用之前在`ranking-store`里的`rankingMap`：

![rankingMap](assets/img/2022-03-29-17-47-59.png)

> 这种简写方式可读性不强 -> 但如果你理解清楚了，可以少写很多代码

![rankingMap](assets/img/2022-03-29-17-51-46.png)

获取这些数据的意义：

![获取数据](assets/img/2022-03-29-17-54-09.png)

> [Demo](https://github.com/ppambler/QQMusic/commit/2375309)

3）答疑

💡：自定义属性`data`可以传对象吗？

可以的

国外视频起名 -> `index`、`indez`、`indey` -> 所以老师习惯叫`idx`，而不是`id`

4）掌握歌曲详情页-榜单数据展示

💡：详情页知道拿什么数据后，那就得获取这个数据了，获取完数据后，就得展示数据

获取数据：

![数据获取](assets/img/2022-03-29-18-27-24.png)

展示数据：

1. 把数据存放到`songInfo`里边
2. 定义`wxml`结构展示数据

💡：创建一个`song-item-v2`

![song-item-v2](assets/img/2022-03-29-18-33-52.png)

不知属性名代表哪些数据？

![数据](assets/img/2022-03-29-18-39-28.png)

关于样式的拷贝？

由于经常封装组件，你的样式起名一定要符合你的习惯 -> `song-item-v1`和`song-item-v2`的样式有共通之处 -> 样式起名，也就是给组件标签添加`class`要一致

优化：有些歌曲没有别名

![别名](assets/img/2022-03-29-18-47-17.png)

> 01 34 59

> [Demo](https://github.com/ppambler/QQMusic/commit/34ebf96)

👇：点击歌单的区分

5）

