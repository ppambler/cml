### ✍️ Tangxt ⏳ 2022-05-10 🏷️ 小程序

# 11-HYMusic 细节功能补充

1）答疑

💡：JS 高级

看老师这个课 -> 红宝石这本书注重用法，原理啥的不是很深入

💡：react 项目

hooks 开发是趋势，很多项目还是用 class -> 这两个东西都需要掌握

2）理解轮播图高度计算不正确 bug 处理

💡：轮播图 bug

这个 bug 很难复现

如果容易复现的话，那就很容易找到原因，最后再用代码一点点地去修复

每次出现这个 bug 是规律的

这个图片高度每次都那么高 -> 猜测是默认的 `240`

![高度](assets/img/2022-05-10-13-13-18.png)

造成这个 bug 的原因：宽高比还未计算完成，就调用回调了 -> 这是小程序启动时的 bug

图片加载完的最后一次也执行回调，而不是只执行开头的初始化一次：

![解决 bug](assets/img/2022-05-10-18-34-13.png)

> 程序员每天 -> 要么写 bug，要么改 bug -> 如操作系统，也是一个软件，每天都在修复 bug

3）掌握播放的小问题处理-同一首歌播放和新歌信息重置

> 2 20 25

要完成的功能：

- 下一首与上一首
- 首页展示播放条 -> 旋转图片，暂停后，图片的旋转初始化了，按理说应该会从原先的位置继续旋转

要优化的部分：

- 重复进入同一首歌，不应该重新播放
  - 从暂停状态切出去，再回来会继续播放
- 从播放页返回，选择一首新歌，进入到播放页，会有上一首歌的信息残留

![优化](assets/img/2022-05-10-20-10-25.png)

> [Demo](https://github.com/ppambler/QQMusic/commit/5228ab9)

代码细节：

![细节](assets/img/2022-05-10-19-45-11.png)

> 函数体里边的代码自己取反操作，太绝对了 -> 可以给一个默认值

4）掌握点击播放添加播放列表和索引

> 2 04 52

多掌握这个项目里边涉及到的思想，毕竟做音乐播放器的公司就那么几家！

💡：要完成的功能

- click -> 上一首和下一首
- 音乐播放完 -> 自动播放下一首

如何实现？

1. 要有歌曲列表，没有这个，谈何下一首和上一首
2. 歌曲列表要共享 -> 首页会用到
3. 正在播放歌曲在歌曲列表里边的索引

![实现](assets/img/2022-05-10-20-30-38.png)

💡：造播放列表这个数据

![播放列表](assets/img/2022-05-10-20-52-03.png)

如果你是从 收藏、历史 等里边选择歌曲的，那么就把收藏列表和历史列表作为当前的歌曲播放列表

还是在组件里边写点击这个逻辑吗？ -> 显然不是，在使用组件的页面里边写，可以监听到在哪个列表被点击了，以及被点击的歌的索引

![播放列表数据](assets/img/2022-05-10-21-33-47.png)

> [Demo](https://github.com/ppambler/QQMusic/commit/f70aa9c)

💡：下一首与上一首的逻辑

- 需要根据播放模式来决定

💡：不要把孤勇者作为测试歌曲，这首歌太不安静了

选择安静的「这世界那么多人」

5）

> 1 42 34
