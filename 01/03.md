### ✍️ Tangxt ⏳ 2021-12-09 🏷️ 小程序

# 03-小程序核心语法

1）开篇介绍

本章会讲解小程序里边所有的核心语法，主要讲的内容，分成了以下三大块：

![三块内容](assets/img/2021-12-09-15-24-43.png)

- 第一块：数据驱动原则 -> 现阶段前端开发或者大前端开发的一个核心原则之一，无论是小程序，还是三大框架 Vue、React、Angular，它们都秉承了基本的数据驱动原则 -> 这一块必须优先掌握
- 第二块：通过两个案例来串联整个第三章中的所有核心知识点
  - 案例 1：商品案例
  - 案例 2：列表案例

这两个案例都搞懂了，意味着第三章的内容都掌握了

2）小程序的数据驱动原则

> 界面依赖数据，数据变化了，界面响应式的更新

1、问题

> 1. 什么是数据驱动？
> 2. 在小程序中如何完成数据绑定？

2、数据驱动

```js
// 商品
let product = {
  price: 10,
  num: 5
}
// 总价格
let total = 0;
// 计算总价格的方法
function getTotal(product) {
  return product.price * product.num
}
// 计算商品的总价格
total = getTotal(product)
// 进行打印
console.log('总价格：' + total);
// 50 太贵了，所以我们少购买了两个商品，也就是让 num = 3
product.num = 3;
// 问：总价格是多少？
console.log('总价格：' + total); // 此时，打印发现总价格还是 50 元，如果要说原因的话，那么应该很简单，【因为我们没有重新进行价格的计算嘛】
// 但是，此时大家有没有想过一点？我们为什么要进行价格的计算呢？
// ----------------------------------------------------
// 当商品的数量发生变化时，商品的总价格【理应发生变化】，不是吗？
```

上面的例子，就是我想要跟大家说的：【当数量发生变化时，商品的总价格理应发生改变】。

那么同样的道理，在我们的页面中，假如：

> 某一个 DOM 依赖于某个数据进行展示，那么【当数据发生变化时，视图也理应发生变化】。

而这个就是【响应式数据驱动】。

> PS：如果你想要更深入的了解，那么你可以查看这篇博客：[Vue 3 深入响应式原理 - 聊一聊响应式构建的那些经历_慕课手记](https://www.imooc.com/article/320582)

3、小程序中完成响应式

- 在 `data` 中定义数据
  
  ![定义数据](assets/img/2021-12-09-19-16-33.png)
  
- 在 `wxml` 中使用数据
  
  ![使用数据](assets/img/2021-12-09-19-17-53.png)
  

现在我们已经可以在 `js 的 data` 中定义数据，并且在 `wxml 中通过 🟡🟡🟡🟡` 语法使用数据。

那么我们回过头来看我们的问题：

4、答案

> 1. 什么是数据驱动？
>    1. 当数据发生变化时，视图理应发生变化
> 2. 在小程序中如何完成数据绑定？
>    1. 在 `data` 中定义数据
>    2. 在 `wxml` 中通过 `🟡🟡🟡🟡` 使用数据

但是在此时，大家心里应该还有一个疑惑，那就是：【现在数据还没有发生变化呀？我也没有看到视图的变化呀？】。

如果你心中确实有这么一个困惑的话，那么就继续往下看！

3）小程序的常用事件与属性列表

> `product.num`这个`.`是特殊字符，所以需要加`''`

1、问题

> 1. 如何为按钮添加点击事件？
> 2. 如何修改 `data` 中数据的值？

2、处理点击事件

接下来我们希望做一件事情：

> 创建一个按钮
>
> 当用户点击按钮时
>
> 让 `product` 的 `num` + 1

创建按钮的方式非常简单：

``` html
<button type="primary">num + 1</button>
```

问题在于：我们如何给这个按钮添加点击事件呢？

有过开发经验的同学，可能会猜到：我们可以给 `button` 一个 `click` 事件来监听按钮的点击。

可是大家需要知道，现在我们是在【小程序】中，所以如果你想要给 `button` 添加点击事件的话，我们是不可以使用 `click`的，而是使用**`bind:tap / bindtap`**。（推荐使用`bindtap`）

> `bind`是个关键字

其中 `bind: / bind` 表示【绑定事件】，`tap` 为绑定的具体事件。小程序具体事件列表，可以点击 [这里](https://developers.weixin.qq.com/miniprogram/dev/framework/view/wxml/event.html#%E4%BA%8B%E4%BB%B6%E7%9A%84%E4%BD%BF%E7%94%A8%E6%96%B9%E5%BC%8F) 查看。

``` html
<button type="primary" bindtap="onAddNum">num + 1</button>
```

接下来需要在 `js` 中定义对应的 **事件**

```js
/**
* 定义事件处理的方法
*/
{
  onAddNum () {
    console.log('onAddNum')
  }
}
```

到目前：我们已经 **监听了按钮的点击事件，并且写入了对应的处理函数** ，接下来就需要 **修改 `num` 的值**

![tap 事件](assets/img/2021-12-09-20-45-44.png)

3、修改 data 的数据：`setData`

想要修改 `data` 中的数据，那么我们需要借助一个函数 `setData`。

`setData` 接收一个对象作为参数，这个对象就是最新的 `data` 数据。

其中 `key` 为要修改的数据， `value` 为当前`key`的最新值

4、访问 data 的数据：`this.data`

因为我们想要让 `num + 1` ，所以我们还需要拿到 `num` 的当前值，想要访问 `num` 的值，可以通过 `this.data.product.num` 的形式访问

所以最终的修改 `num` 的代码为：

![num+1](assets/img/2021-12-09-20-54-09.png)

此时，当我们点击 `button` ，可以发现：【当 `num` 发生改变时，总价格也发生了对应的变化】

5、答案

> 1. 如何为按钮添加点击事件？
>    1. `bindtap` or `bind:tap`
> 2. 如何修改 data 中数据的值？
>    1. 通过 `this.setData({})` 定义新的值
>    2. 通过 `this.data` 访问具体的值

4）小程序的事件传参

1、问题

> 如果想要在【点击事件中】传递参数，那么需要怎么做？

2、新的需求

现在让我们把需求变得更加复杂一些。

> 我们希望 `onAddNum` 方法可以接收一个参数，每次点击 `num` 增加的数量为传入的参数

那么如果想要实现这个需求的话，那么就需要涉及到一个知识点：【事件传参】。

如果大家有过开发经验的话，那么可能会认为这是一个非常简单的需求，顺便可以写下如下代码：

![代码](assets/img/2021-12-09-21-33-21.png)

假如我们真按照以上代码进行实现的话，那么 **你应该会收到以下如下的警告：**

![警告](assets/img/2021-12-09-21-34-09.png)

这个警告的意思是：没有一个叫做 `onAddNumN(5)` 的方法用来处理当前的这个 `tap` 事件。

也即是说：`onAddNumN(5)` 会被当做一个 **完整的方法名字**，而不是 方法名为：`onAddNumN`，传入了参数为 `5` ！

那么如果我们想要传递参数，那应该怎么做呢？

> 文档：[事件 - 微信开放文档](https://developers.weixin.qq.com/miniprogram/dev/framework/view/wxml/event.html#dataset)

在小程序中，如果想要给 **点击事件传递参数的话，**那么需要借助 **`event`对象** 和 **`data-`属性** ！

参数的传递包含两个部分：

1. 形参 -> 起到形参功能的就是`event`对象 -> 表示当前函数想要接收到的参数
2. 实参 -> 起到实参功能的就是`data-`属性 -> 表示调用当前函数实际传递的参数

3、形参

首先先来看 **形参**，对于 **点击事件的回调方法** 而言，默认会接收一个参数 **event （事件对象）**。这个 `event` 对象为：**回调方法的唯一参数**

也就是说回调方法只有一个形参，那就是`event`（可简写成`e`）

``` js
{
  onAddNumN (e) {}
}
```

4、实参

对于 **小程序** 中，我们不能直接为 **回调方法传递实参**。

而是需要通过：**属性绑定的形式，把需要传递的参数绑定到 当前 `DOM` 元素中**，绑定数据的属性需要以 `data-` 开头。该属性可以通过 `e.target.dataset` 进行访问。

![event](assets/img/2021-12-09-22-12-18.png)

---

最终实现：

![实现](assets/img/2021-12-09-22-20-01.png)

5、答案

![答案](assets/img/2021-12-09-22-22-31.png)

5）实现【双向数据绑定】

1、问题

> 1. 什么叫做双向数据绑定？
> 2. 小程序中如何实现双向数据绑定？

2、实现双向数据绑定

上一章节中我们通过【事件传参】实现了【每次点击 + 5】 的功能，但是这样的功能未免还是有些太单调了。

所以我们接下来希望实现一个新的功能：

> 创建一个数字输入框，输入框 与【商品数量】完成 【双向数据绑定】。
>
> 即：
>
> 1. 输入框内容（视图）发生变化时，商品数量（数据）同步跟随变化
> 2. 商品数量（数据）发生变化时，输入框内容（视图）同步跟随变化

那么这样的功能我们应该如何去实现呢？

---

如果想要实现这个功能，那么我们需要先把这个功能进行拆解，【**把一个复杂的功能拆解成多个简单的功能或者说多个可执行的步骤**】是实现一个复杂逻辑的标准方式。

那么如何进行拆解呢？ **大家可以先进行以下思考，然后再继续向下进行学习！**

---

以上功能可拆解成五个步骤，步骤如下：

> 1. 创建一个【数字输入框】
> 2. 设置 【商品数量】 为输入框的初始值
> 3. 监听用户的输入行为
> 4. 获取用户输入的值
> 5. 赋值给【商品数量】

根据这可量化的步骤去实现我们的功能

![功能实现](assets/img/2021-12-09-23-12-21.png)

题外话：查看一个组件文档（想要看看`input`组件给我们提供了哪些能力）

![文档](assets/img/2021-12-09-23-13-38.png)

那么现在功能我们已经实现了，那么大家在回忆一下我们的问题：

3、答案

第一个问题：

![双向绑定](assets/img/2021-12-09-23-16-45.png)

第二个问题：

![实现双向绑定](assets/img/2021-12-09-23-23-49.png)

6）条件渲染







