### âœï¸ Tangxt â³ 2021-12-27 ğŸ·ï¸ uni-app

# ç¬¬ 9 ç«  ç”¨æˆ·ç™»å½•

1ï¼‰å¼€ç¯‡

åœ¨ä¸Šä¸€ç« ä¸­ï¼Œæˆ‘ä»¬è¯´åˆ°ï¼šå¦‚æœæƒ³è¦å®Œæˆï¼šå…³æ³¨ã€æ”¶è—ã€ç‚¹èµã€è¯„è®º è¿™äº›åŠŸèƒ½çš„è¯ï¼Œé‚£ä¹ˆéœ€è¦é¦–å…ˆå®Œæˆ **ç”¨æˆ·ç™»å½•** çš„åŠŸèƒ½ã€‚

é‚£ä¹ˆè¿™ä¸€ç« ä¸­ï¼Œæˆ‘ä»¬å°±æ¥çœ‹ä¸€ä¸‹ï¼Œæˆ‘ä»¬åº”è¯¥å¦‚ä½•å®Œæˆ **ç”¨æˆ·ç™»å½•** çš„åŠŸèƒ½å®ç°ã€‚

é¦–å…ˆæˆ‘ä»¬å…ˆæ¥çœ‹ä¸€ä¸‹ **ç”¨æˆ·ç™»å½•** çš„ä¸šåŠ¡é€»è¾‘ã€‚

å¯¹äº **ç”¨æˆ·ç™»å½•** æ¥è¯´ï¼Œä¸»è¦æœ‰ä¸¤ä¸ªç™»å½•çš„å…¥å£ï¼š

1. åœ¨ã€Šæˆ‘çš„é¡µé¢ã€‹ä¸­ -> ä¹Ÿå«ä¸ªäººä¸­å¿ƒ
2. åœ¨è°ƒç”¨éœ€è¦ç™»å½•æƒé™çš„åŠŸèƒ½æ—¶

![ç™»å½•å…¥å£](assets/img/2021-12-27-19-35-40.png)

é‚£ä¹ˆåœ¨æ˜ç¡®äº† **ç”¨æˆ·ç™»å½•** çš„ä¸šåŠ¡é€»è¾‘ä¹‹åï¼Œæ¥ä¸‹æ¥æˆ‘ä»¬å°±å»å®ç°ç”¨æˆ·ç™»å½•çš„å¯¹åº”åŠŸèƒ½ã€‚

2ï¼‰ç”¨æˆ·ç™»å½• - ç™»å½•é¡µé¢åŸºæœ¬æ ·å¼

æ•ˆæœï¼š

![æ•ˆæœ](assets/img/2021-12-27-20-38-44.png)

> [Demo](https://github.com/ppambler/imooc-uni-app/commit/fa93150)

3ï¼‰ç”¨æˆ·ç™»å½• - å°è£…ç™»å½•ç»„ä»¶

åœ¨å¼€ç¯‡ä¸­ï¼Œæˆ‘ä»¬è¯´åˆ°ï¼Œå¯¹äº **ç™»å½•** åŠŸèƒ½æ¥è¯´æä¾›äº†ä¸¤ä¸ªç™»å½•çš„å…¥å£ã€‚

é‚£ä¹ˆå¤§å®¶æƒ³ä¸€ä¸‹ï¼Œç°åœ¨æˆ‘ä»¬å·²ç»åœ¨ **æˆ‘çš„** è¿™ä¸ª `tab é¡µ` ä¸­å®ç°äº† **ç™»å½•çš„ `UI`**ï¼Œéš¾é“æˆ‘è¿˜éœ€è¦åœ¨å¦å¤–ä¸€ä¸ªé¡µé¢ä¸­å†å»å®ç°ä¸€éå—ï¼Ÿ

è¿™ä¸ªè‚¯å®šæ˜¯ä¸éœ€è¦çš„ï¼Œå¯¹ä¸å¯¹ã€‚æ‰€ä»¥æˆ‘ä»¬å¸Œæœ›å¯ä»¥å¤ç”¨**ç™»å½•çš„ `UI`**ï¼Œè€Œå¤ç”¨çš„æ–¹å¼åˆ™å¯ä»¥æŠŠ **ç™»å½•çš„ `UI`** å°è£…ç§°ä¸ºä¸€ä¸ª **ç»„ä»¶**

1. åˆ›å»ºç™»å½•ç»„ä»¶ `my-login`
2. åœ¨`my`é‡Œè¾¹ä½¿ç”¨`my-login`ç»„ä»¶

**åœ¨è°ƒç”¨éœ€è¦ç™»å½•æƒé™çš„åŠŸèƒ½æ—¶ï¼Œè¿›å…¥çš„ç™»å½•é¡µé¢** -> æˆ‘ä»¬å…ˆä¸éœ€è¦å»åˆ›å»ºï¼Œç­‰åˆ°ä½¿ç”¨çš„æ—¶å€™ï¼Œå†åˆ›å»ºå°±å¯ä»¥äº†ã€‚

> [Demo](https://github.com/ppambler/imooc-uni-app/commit/dbf9c6f)

4ï¼‰ç”¨æˆ·ç™»å½• - æ˜ç¡®ç™»å½•çš„å®ç°æ€è·¯

åœ¨å®ç°ç™»å½•çš„å…·ä½“åŠŸèƒ½ä¹‹å‰ï¼Œä¸ºäº†é¿å…ä¸€äº›æ²¡æœ‰å¼€å‘ç»éªŒçš„åŒå­¦ç›´æ¥çœ‹ä»£ç ä¸€è„¸æ‡µé€¼ï¼Œæˆ‘ä»¬éœ€è¦å…ˆæ¥æ˜ç¡®ä¸€ä¸‹ç™»å½•çš„å®ç°åŸºæœ¬é€»è¾‘ã€‚

é¦–å…ˆå¯¹äºç™»å½•æ¥è¯´ï¼Œæˆ‘ä»¬ä¼šåˆ†ä¸ºä¸¤ä¸ªä¸åŒçš„ç«¯æ¥è¿›è¡Œé€‚é…å®ç°ï¼š

1. å¾®ä¿¡å°ç¨‹åº
2. éå¾®ä¿¡å°ç¨‹åºï¼ˆåœ¨è®²è§£é€‚é…æ—¶å®ç°ï¼‰

æˆ‘ä»¬è¿™é‡Œå…ˆåªè®²è§£ ã€å¾®ä¿¡å°ç¨‹åºçš„å®ç°ã€‘ï¼Œã€éå¾®ä¿¡å°ç¨‹åºã€‘çš„å®ç°å°†åœ¨åé¢çš„ **é€‚é…ç¯èŠ‚è¿›è¡Œ**ã€‚

**å¾®ä¿¡å°ç¨‹åºï¼š**

1. æƒ³è¦å®ç°ç™»å½•åŠŸèƒ½ï¼Œé‚£ä¹ˆæˆ‘ä»¬éœ€è¦è°ƒç”¨ç™»å½•æ¥å£æ¥è¿›è¡Œå®ç°ï¼Œè€Œç™»å½•æ¥å£æ‰€éœ€è¦çš„å‚æ•°ï¼Œæˆ‘ä»¬å¯ä»¥ç›´æ¥é€šè¿‡ `getUserProfile` æ–¹æ³•è¿›è¡Œè·å–ã€‚
2. è°ƒç”¨ç™»å½•æ¥å£æˆåŠŸï¼ŒæœåŠ¡ç«¯ä¼šè¿”å›ç”¨æˆ·çš„ `token`ï¼Œè¿™ä¸ª `token` ä¸ºå½“å‰çš„ç”¨æˆ·èº«ä»½ä»¤ç‰Œã€‚ï¼ˆæ‹¥æœ‰ tokenï¼‰ åˆ™è¡¨ç¤ºç”¨æˆ·å·²ç»ç™»å½•äº†ã€‚
3. è€Œæ­¤å¤„çš„ `token`ï¼Œæˆ‘ä»¬éœ€è¦åœ¨å¤šä¸ªç»„ä»¶ä¸­è¿›è¡Œä½¿ç”¨ï¼Œæ‰€ä»¥ `token` éœ€è¦è¢«ä¿å­˜åˆ° `å…¨å±€çŠ¶æ€ç®¡ç†å·¥å…· - vuex` ä¸­ï¼ŒåŒæ—¶éœ€è¦ä¿å­˜çš„è¿˜æœ‰é€šè¿‡ `getUserProfile` è·å–åˆ°çš„ç”¨æˆ·åŸºæœ¬ä¿¡æ¯ã€‚
4. è€Œå½“å‰çš„ç”¨æˆ·ç™»å½•çŠ¶æ€ï¼Œæˆ‘ä»¬å¸Œæœ›å¯ä»¥ä¸€ç›´ä¿å­˜ï¼ˆPSï¼šä¸éœ€è¦æ¯æ¬¡éƒ½è¿›è¡Œç™»å½•ï¼‰ã€‚æ‰€ä»¥åœ¨ç™»å½•å®Œæˆåï¼Œæˆ‘ä»¬éœ€è¦æŠŠ **`token` å’Œ `userinfo`** ä¿å­˜åˆ° **æœ¬åœ°å­˜å‚¨ä¸­**
5. æœ€åï¼Œä¸ºäº†å®ç° **æ•°æ®ä¸ç»„ä»¶çš„åˆ†ç¦»**ï¼Œæˆ‘ä»¬éœ€è¦æŠŠä¸ **ä¸ç™»å½•ç›¸å…³çš„é€»è¾‘** éƒ½å°è£…åœ¨ `vuex` ä¸­è¿›è¡Œã€‚

è¿™äº›ä¸šåŠ¡æ˜¯ **å‰ç«¯ç”¨æˆ·ç™»å½•çš„æ ‡å‡†é€»è¾‘**ï¼Œå¤§å®¶åœ¨ä»¥åçš„å‰ç«¯ç™»å½•ä¸šåŠ¡å¤„ç†ä¸­ï¼Œä¹Ÿå¯ä»¥æŒ‰ç…§æ­¤é€»è¾‘è¿›è¡Œã€‚

é‚£ä¹ˆä»ä¸‹ä¸€å°èŠ‚å¼€å§‹ï¼Œæˆ‘ä»¬å°±æŒ‰ç…§è¿™ä¸ªé€»è¾‘å®ç°ä¸€ä¸‹å¯¹åº”çš„ä»£ç ã€‚

5ï¼‰ç”¨æˆ·ç™»å½• - å°è£… action è°ƒç”¨ç™»å½•æ¥å£

åœ¨ä¸Šä¸€å°èŠ‚ä¸­ï¼Œæˆ‘ä»¬åˆ†æäº†ã€å¾®ä¿¡å°ç¨‹åºã€‘ä¸­è¿›è¡Œç™»å½•çš„å®ç°é€»è¾‘ï¼Œé‚£ä¹ˆä»è¿™ä¸€å°èŠ‚å¼€å§‹ï¼Œæˆ‘ä»¬å°±å®ç°å¯¹åº”çš„åŠŸèƒ½ã€‚

![ç™»å½•æµç¨‹](assets/img/2021-12-27-23-12-11.png)

å®ç°ï¼š

1. åœ¨`api/user.js`é‡Œè¾¹å®šä¹‰`login`å‡½æ•°ï¼Œç”¨æ¥å‘é€`POST`è¯·æ±‚ï¼Œè¯·æ±‚åœ°å€æ˜¯`'/sys/login'`ï¼Œä¼ é€’çš„æ•°æ®æ˜¯ã€Œç”¨æˆ·ä¿¡æ¯ã€
2. åœ¨`my-login`é‡Œè¾¹å®šä¹‰`getUserInfo`æ–¹æ³•ï¼Œç”¨æ¥è·å–ç”¨æˆ·ä¿¡æ¯ï¼Œè¿™ä¸ªä¿¡æ¯æ˜¯å¾®ä¿¡ç™»å½•çš„ç”¨æˆ·ä¿¡æ¯ -> æŠŠè¿™ä¸ªç”¨æˆ·ä¿¡æ¯äº¤ç»™åœ¨`vuex`é‡Œè¾¹å®šä¹‰çš„`login`æ–¹æ³•ï¼Œç”¨ä½œç™»å½•æ—¶çš„è¯·æ±‚å‚æ•°
3. åœ¨`store/user.js`é‡Œè¾¹å®šä¹‰`user`æ¨¡å—ï¼Œåœ¨`store/index.js`é‡Œè¾¹æ³¨å†Œ`user`æ¨¡å—ï¼Œåœ¨`my-login`é‡Œè¾¹é€šè¿‡`mapActions`æ³¨å†Œ`user`æ¨¡å—çš„`login`æ–¹æ³•

> [Demo](https://github.com/ppambler/imooc-uni-app/commit/d935742)

6ï¼‰ç”¨æˆ·ç™»å½• - ä¿å­˜ç”¨æˆ·ç™»å½•çŠ¶æ€

ç”¨æˆ·çš„ç™»å½•çŠ¶æ€éœ€è¦è¢«ä¿å­˜åˆ° `vuex` ä¸­ï¼ŒåŒæ—¶éœ€è¦è¿›è¡Œ **æœ¬åœ°å­˜å‚¨**ã€‚

- ç”¨æˆ·ä¿¡æ¯
- ç”¨æˆ·`token`

æ•ˆæœï¼š

![æ•ˆæœ](assets/img/2021-12-28-16-31-53.png)

> [Demo](https://github.com/ppambler/imooc-uni-app/commit/7e9ba20)

7ï¼‰ç”¨æˆ·ç™»å½• - å®Œæˆå·²ç™»å½•çš„ç”¨æˆ·è§†å›¾

å½“ `token` å­˜åœ¨æ—¶ï¼Œè¡¨ç¤ºç”¨æˆ·å·²ç»ç™»å½•äº†ï¼Œæ­¤æ—¶éœ€è¦ **å±•ç¤ºç”¨æˆ·ç™»å½•å®Œæˆçš„è§†å›¾ï¼š**

![å·²ç™»å½•](assets/img/2021-12-28-16-37-56.png)

> [Demo](https://github.com/ppambler/imooc-uni-app/commit/9c7ce0b)

8ï¼‰ç”¨æˆ·ç™»å½• - å®ç°é€€å‡ºç™»å½•åŠŸèƒ½

åˆ é™¤`token`å’Œç”¨æˆ·ä¿¡æ¯å³å¯ -> ä¸¤ä¸ªåœ°æ–¹éœ€è¦åˆ é™¤ï¼Œ`vuex`å’Œæœ¬åœ°å­˜å‚¨

![é€€å‡ºç™»å½•](assets/img/2021-12-28-17-14-43.png)

> [Demo](https://github.com/ppambler/imooc-uni-app/commit/5cc2bb8)

9ï¼‰ç”¨æˆ·ç™»å½• - åˆ¤æ–­ç”¨æˆ·ç™»å½•çŠ¶æ€

æˆªæ­¢åˆ°ç›®å‰ä¸ºæ­¢ï¼Œ **ç”¨æˆ·ç™»å½•** çš„åŠŸèƒ½å…¶å®å°±å·²ç»å…¨éƒ¨æ„å»ºå®Œæ¯•äº†ã€‚

æ¥ä¸‹æ¥æˆ‘ä»¬å°±éœ€è¦å®ç°ï¼š

- å…³æ³¨ç”¨æˆ·
- æ–‡ç« ç‚¹èµ
- æ–‡ç« æ”¶è—
- æ–‡ç« è¯„è®º

è¿™å››ä¸ªå¯¹åº”çš„åŠŸèƒ½ã€‚

ä¹‹å‰æˆ‘ä»¬è¯´è¿‡ï¼Œæƒ³è¦å®ç°è¿™å››ä¸ªåŠŸèƒ½ï¼Œ é‚£ä¹ˆéœ€è¦æœ‰ä¸€ä¸ªå‰ææ¡ä»¶å°±æ˜¯ï¼š**å½“å‰ç”¨æˆ·å·²ç™»å½•ã€‚**

æ‰€ä»¥è¯´ï¼Œæˆ‘ä»¬å°±éœ€è¦åœ¨ç”¨æˆ·ä½¿ç”¨è¿™å››ä¸ªåŠŸèƒ½ä¹‹å‰ï¼Œæ¥åˆ¤æ–­ç”¨æˆ·çš„ç™»å½•çŠ¶æ€ã€‚

![ç”¨æˆ·ç™»å½•çŠ¶æ€](assets/img/2021-12-28-17-21-47.png)

ä¹Ÿå°±æ˜¯è¯´ï¼Œåœ¨ **ç”¨æˆ·ç™»å½•åŠŸèƒ½å®Œæˆä¹‹å**ï¼Œæˆ‘ä»¬å…¶å®è¿˜ä¸å¯ä»¥ç«‹åˆ»ç€æ‰‹è¿™å››ä¸ªåŠŸèƒ½çš„å¼€å‘ï¼Œæˆ‘ä»¬è¿˜éœ€è¦è¿›è¡Œä¸€æ­¥æ“ä½œï¼Œé‚£å°±æ˜¯ **åˆ¤æ–­ç”¨æˆ·çš„ç™»å½•çŠ¶æ€ï¼**

æƒ³è¦åˆ¤æ–­ç”¨æˆ·çš„ç™»å½•çŠ¶æ€ï¼Œæˆ‘ä»¬ä¾ç„¶éœ€è¦åœ¨ `vuex` ä¸­è¿›è¡Œï¼ˆæ•°æ®å’Œç»„ä»¶åˆ†ç¦»ï¼‰ï¼š

![ç™»å½•çŠ¶æ€](assets/img/2021-12-28-17-20-27.png)

> [Demo](https://github.com/ppambler/imooc-uni-app/commit/3891588)

å¦‚æœç”¨æˆ·æœªç™»å½•ï¼Œåˆ™å¼•å¯¼ç”¨æˆ·è¿›å…¥ç™»å½•é¡µé¢ï¼Œé‚£ä¹ˆè¿™ä¸€æ­¥åŠŸèƒ½å¦‚ä½•è¿›è¡Œå®ç°å‘¢ï¼Ÿ

![ç™»å½•é¡µé¢](assets/img/2021-12-28-17-23-13.png)

10ï¼‰ç”¨æˆ·ç™»å½• - æ–°å»ºç™»å½•é¡µé¢ï¼Œå¤„ç†å½“å‰åœºæ™¯

å¼€ç¯‡çš„æ—¶å€™ï¼Œæˆ‘ä»¬è¯´è¿‡ï¼Œå¯¹äº **ç™»å½•** æ¥è¯´ï¼ŒåŒ…å«æœ‰ä¸¤ä¸ªå…¥å£ï¼š

1. åœ¨ ã€Šæˆ‘çš„é¡µé¢ã€‹ä¸­
2. åœ¨è°ƒç”¨éœ€è¦ç™»å½•æƒé™çš„åŠŸèƒ½æ—¶

é‚£ä¹ˆæ­¤æ—¶ï¼Œå°±æ˜¯ä½¿ç”¨åˆ°ç¬¬äºŒä¸ªåœºæ™¯çš„æ—¶å€™äº†ã€‚

1. æˆ‘ä»¬åˆ›å»ºä¸€ä¸ªæ–°é¡µé¢ï¼Œå«åš `login-page`ï¼Œåœ¨è¿™ä¸ªé¡µé¢ä¸­ï¼Œå¯¼å…¥ `my-login` ç»„ä»¶
2. å½“ **è¿›è¡Œç™»å½•åˆ¤å®šï¼Œç”¨æˆ·æœªç™»å½•æ—¶ï¼Œè¿›å…¥ `login-page` é¡µé¢**
3. åœ¨ **å…³æ³¨** ç”¨æˆ·æ—¶ï¼Œè°ƒç”¨è¿™ä¸ª`isLogin` `action`

æ³¨æ„ç‚¹ï¼š

- `uni.showModal`çš„è¿”å›å€¼ -> æ ¹æ®ä½ æ˜¯ç‚¹å‡»ç¡®å®šè¿˜æ˜¯ç‚¹å‡»å–æ¶ˆï¼Œæ¥å†³å®šä¸‹ä¸€æ­¥æ“ä½œ
- `uni.showModal`çš„ä½¿ç”¨ -> æ²¡æœ‰ç”¨`success`æ–¹æ³•ï¼Œè€Œæ˜¯ç”¨äº†`async/await`å»å¤„ç† -> å› ä¸ºéœ€è¦è¿”å›`false`

æ•ˆæœï¼š

![æ•ˆæœ](assets/img/2021-12-28-18-48-34.png)

> [Demo](https://github.com/ppambler/imooc-uni-app/commit/06cff8c)

11ï¼‰ç”¨æˆ·ç™»å½• - ç›‘å¬ç™»å½•æˆåŠŸçš„çŠ¶æ€ï¼Œè¿”å›ä¹‹å‰é¡µé¢

åœ¨ä¸Šä¸€èŠ‚ï¼Œæˆ‘ä»¬å·²ç»å®Œæˆäº† **åœ¨è°ƒç”¨éœ€è¦ç™»å½•æƒé™çš„åŠŸèƒ½æ—¶ï¼Œè¿›å…¥ç™»å½•é¡µé¢** ï¼Œä½†æ˜¯å½“æˆ‘ä»¬ç™»å½•å®Œæˆä¹‹åï¼Œæˆ‘ä»¬ **è¿˜éœ€è¦è¿”å›ä¹‹å‰é¡µé¢**ï¼Œå› ä¸ºåªæœ‰è¿™æ ·æ‰èƒ½å®Œæˆæˆ‘ä»¬çš„åŠŸèƒ½é—­ç¯ï¼Œæ‰€ä»¥åœ¨è¿™ä¸€å°èŠ‚ä¸­ï¼Œæˆ‘ä»¬å°±å»å®Œæˆè¿™ä¸€å—çš„åŠŸèƒ½ï¼š

1. `my-login`ï¼šåœ¨ç™»å½•æˆåŠŸåï¼Œå‘é€äº‹ä»¶
2. `login-page`ï¼šç›‘å¬ç™»å½•æˆåŠŸçš„äº‹ä»¶ï¼Œå¹¶è¿”å›ä¸Šä¸€ä¸ªé¡µé¢

æ•ˆæœï¼š

![æ•ˆæœ](assets/img/2021-12-28-18-58-27.png)

> [Demo](https://github.com/ppambler/imooc-uni-app/commit/8468fc2)

12ï¼‰ç”¨æˆ·ç™»å½• - å¤„ç†ç™»å½•æ—¶æ—  loading çš„ bug

![loading bug](assets/img/2021-12-28-19-02-47.png)

13ï¼‰æ–‡ç« æ“ä½œ - å…³æ³¨ç”¨æˆ·

