### ✍️ Tangxt ⏳ 2021-12-27 🏷️ uni-app

# 第 9 章 用户登录

1）开篇

在上一章中，我们说到：如果想要完成：关注、收藏、点赞、评论 这些功能的话，那么需要首先完成 **用户登录** 的功能。

那么这一章中，我们就来看一下，我们应该如何完成 **用户登录** 的功能实现。

首先我们先来看一下 **用户登录** 的业务逻辑。

对于 **用户登录** 来说，主要有两个登录的入口：

1. 在《我的页面》中 -> 也叫个人中心
2. 在调用需要登录权限的功能时

![登录入口](assets/img/2021-12-27-19-35-40.png)

那么在明确了 **用户登录** 的业务逻辑之后，接下来我们就去实现用户登录的对应功能。

2）用户登录 - 登录页面基本样式

效果：

![效果](assets/img/2021-12-27-20-38-44.png)

> [Demo](https://github.com/ppambler/imooc-uni-app/commit/fa93150)

3）用户登录 - 封装登录组件

在开篇中，我们说到，对于 **登录** 功能来说提供了两个登录的入口。

那么大家想一下，现在我们已经在 **我的** 这个 `tab 页` 中实现了 **登录的 `UI`**，难道我还需要在另外一个页面中再去实现一遍吗？

这个肯定是不需要的，对不对。所以我们希望可以复用**登录的 `UI`**，而复用的方式则可以把 **登录的 `UI`** 封装称为一个 **组件**

1. 创建登录组件 `my-login`
2. 在`my`里边使用`my-login`组件

**在调用需要登录权限的功能时，进入的登录页面** -> 我们先不需要去创建，等到使用的时候，再创建就可以了。

> [Demo](https://github.com/ppambler/imooc-uni-app/commit/dbf9c6f)

4）用户登录 - 明确登录的实现思路

在实现登录的具体功能之前，为了避免一些没有开发经验的同学直接看代码一脸懵逼，我们需要先来明确一下登录的实现基本逻辑。

首先对于登录来说，我们会分为两个不同的端来进行适配实现：

1. 微信小程序
2. 非微信小程序（在讲解适配时实现）

我们这里先只讲解 【微信小程序的实现】，【非微信小程序】的实现将在后面的 **适配环节进行**。

**微信小程序：**

1. 想要实现登录功能，那么我们需要调用登录接口来进行实现，而登录接口所需要的参数，我们可以直接通过 `getUserProfile` 方法进行获取。
2. 调用登录接口成功，服务端会返回用户的 `token`，这个 `token` 为当前的用户身份令牌。（拥有 token） 则表示用户已经登录了。
3. 而此处的 `token`，我们需要在多个组件中进行使用，所以 `token` 需要被保存到 `全局状态管理工具 - vuex` 中，同时需要保存的还有通过 `getUserProfile` 获取到的用户基本信息。
4. 而当前的用户登录状态，我们希望可以一直保存（PS：不需要每次都进行登录）。所以在登录完成后，我们需要把 **`token` 和 `userinfo`** 保存到 **本地存储中**
5. 最后，为了实现 **数据与组件的分离**，我们需要把与 **与登录相关的逻辑** 都封装在 `vuex` 中进行。

这些业务是 **前端用户登录的标准逻辑**，大家在以后的前端登录业务处理中，也可以按照此逻辑进行。

那么从下一小节开始，我们就按照这个逻辑实现一下对应的代码。

5）用户登录 - 封装 action 调用登录接口

在上一小节中，我们分析了【微信小程序】中进行登录的实现逻辑，那么从这一小节开始，我们就实现对应的功能。

![登录流程](assets/img/2021-12-27-23-12-11.png)

实现：

1. 在`api/user.js`里边定义`login`函数，用来发送`POST`请求，请求地址是`'/sys/login'`，传递的数据是「用户信息」
2. 在`my-login`里边定义`getUserInfo`方法，用来获取用户信息，这个信息是微信登录的用户信息 -> 把这个用户信息交给在`vuex`里边定义的`login`方法，用作登录时的请求参数
3. 在`store/user.js`里边定义`user`模块，在`store/index.js`里边注册`user`模块，在`my-login`里边通过`mapActions`注册`user`模块的`login`方法

> [Demo](https://github.com/ppambler/imooc-uni-app/commit/d935742)

6）用户登录 - 保存用户登录状态
