### ✍️ Tangxt ⏳ 2021-12-12 🏷️ 小程序

# 04-小程序进阶概念

1）开篇

在上一大章中我们讲解了 **小程序的核心概念**，那么这一章节我们来讲解 **小程序的进阶概念。**

在本章节中我们将会通过一个 **案例** 来贯穿整个进阶内容的知识。

![案例](assets/img/2021-12-13-18-30-46.png)

这个案例看起来似乎很简单，但麻雀虽小，五脏俱全！

同样一个功能可能会有很多不同的一个做法 -> 对于这个案例，我们会通过我们之前没有接触过的小程序知识来实现这样一个功能，其中包括组件化思想、数据监听器、组件的关系和通信、组件中插槽的使用……

2）什么是组件化思想

想要理解小程序中这个「组件」概念 -> 你首先得搞明白一件事，那就是「什么是组件化思想」

一个声明：

**对于组件化思想，如果你没有实际的开发经验的话，那么你可能很难立刻理解它。**

**不过没有关系！**

**随着你对课程的逐渐深入学习，我们会一直为大家灌输组件化思想的概念！**

> 后边用 uni-app 写那个项目的时候，会反复灌输这个「组件化思想」，如果你此刻不能理解，那这也没有关系，随着你接触到越来越多的场景，你就会越来越明白啥是组件化思想了！

---

想要搞明白什么是组件，那么就必须要先搞清楚，组件解决了什么样的问题！ **所有的技术都是因为解决了一个或多个问题，才有存在的价值！**

1、场景

![场景](assets/img/2021-12-13-18-46-35.png)

以上的两张截图是【饿了么小程序】中的数据截图，两个截图来自两个不同的页面。

但是我们可以发现：虽然他们来自于不同页面，但是其中店铺的 `item` 项的结构非常类似。

那么我们现在假象一种场景：

> 现在你在【饿了么】工作，现在你领导让你去完成这两个页面，那你怎么做？
>
> 你会创建两个页面，然后在一个页面中用 `wx:for` 指令，创建一堆 `item` 的 `dom 结构` 然后再去渲染它们的 `wxss`。
>
> 然后在到另外一个页面里面，重复这一系列的操作吗？

如果你是这么做的话？那么我打赌你在【饿了么】待不了 3 天。原因就是因为：**你的代码太冗余了！**，换句话来说就是：**不可维护，不可扩展！**

对于我们软件工程师来说，一般情况下，我们会去遵循 **所有可重复的代码，都是可以封装的！** 

这里的封装放到我们当前这个场景下，指的就是 **组件化** 封装。

明确了我们为啥要进行组件化封装之后，接下来我们就来看一下什么是组件化

2、内容

我们可以把【整个项目】比喻成一个 **乐高积木**：

![乐高积木](assets/img/2021-12-13-18-52-09.png)

那么，对于当前这个项目之中，【每个组件】都可以认为是【其中一块小的积木】（当前一个积木中的一个一个的小零件），这些小的积木可以在当前的项目中使用，也可以直接拿走放到另外的项目中使用。

一个大的项目，由多个小的组件组成，每一个组件都封装了单独的【结构】、【样式】和【行为】。

这就是现在的组件化思想。

> 图中的的 6 个小积木人，是用来插入到那个大积木里边去的，这些小积木人（有不同的颜色和结构，还有不同的行为）就是组件，如果你有其他大积木，那么你可以把这些小积木人插入到其他大积木里边去

如果之前大家有过 `vue、react、angular` 的开发经验的话，那么应该很好理解 **组件化** 指的是什么意思。

如果大家之前只有过 `html + css + js` 的开发经验的话，那么可以把组件理解为：**是一个包含了【结构】和【样式】的模块。**

最后不要忽略，本小节开头的话：

![组件化思想](assets/img/2021-12-13-19-04-29.png)

3）创建第一个组件

1、场景

> 指的是业务场景，简单来说就是「需求」

就像在【开篇】中说到的，**我们会开发一个【案例】，来贯穿整个第四章的内容。**

那么下面我们就来去实现这个案例：

> 对于这个案例，我们把它拆成两个部分：
>
> 1. 顶部的 tabs 
> 2. 底部的 list
>
> 这两个部分，将分别通过两个组件来进行开发 -> 而且这两个组件会产生一定的交互

所以，我们接下来要做的第一件事情，就是【创建这两个组件，并在页面中使用它们】，而这个也就是本小节的主要内容

2、问题

> 1. 组件应该被放入到哪个文件夹中？
> 2. 如何在页面中使用【自定义组件】？

3、内容

1. 创建组件
   1. 创建 `components` 文件夹
   2. 创建 `tabs` 和 `list` 文件夹 -> 用来承载组件的文件夹
   3. 右键 **新建 `Component`** -> 组件的结构几乎和页面一模一样，都是 4 个文件
2. 使用组件
   1. 找到页面的 `.json` 文件 -> 哪个页面需要用到组件？
   2. 在 `usingComponents` 选项下 **注册组件**
      1. `key` 为当前组件在该页面中的标签名
      2. `value` 为组件的代码路径 -> 绝对路径
   3. 在页面的 `wxml` 文件中，以 **注册的 `key`** 为标签名，使用组件

注册组件：

![注册组件](assets/img/2021-12-13-21-33-00.png)

使用组件：

![使用组件](assets/img/2021-12-13-21-32-01.png)

4、答案

> 1. 组件应该被放入到哪个文件夹中？
>    1. `components`
> 2. 如何在页面中使用【自定义组件】？
>    1. 在页面的 `.json` 文件中，通过 `usingComponents` 进行注册
>    2. 注册完后，在 `wxml` 文件中，以注册的 `key`  为 **标签名** 进行使用

以上就是我们「创建第一个组件」所对应的内容了

4）组件的生命周期

> 构建这两个组件的代码 -> 先处理 `tabs` 里边的相关操作 -> `tabs`组件被渲染出来之后，可以获取到对应的数据，并且把这个结构给渲染出来

1、场景

接下来我们希望在 `tabs` 组件被渲染之后，获取 `tabs` 的数据，并且进行渲染。

参考下，上一大章中的 `列表案例` -> 上一章是在页面里边完成，这一次我们要在组件里边完成

要完成这个功能，我们就必须要有一个 **前置条件：**

那就是：**明确组件的生命周期函数，明确在什么时候去获取接口数据** 

2、问题

之前，我们说到小程序里边的生命周期主要分成了两个部分，第一个是页面的生命周期，第二个则是组件的生命周期

> 1. 组件的 **生命周期** 和 **方法** 分别应该被放入到哪个节点下？
> 2. `created` 函数中可以调用 `setData` 吗？
> 3. 获取数据的操作应该在哪个函数中进行？

3、内容

💡：前置知识

**组件** 的生命周期应该被定义在 `lifetimes` 中，而方法必须要放入到 `methods` 中。 -> 这跟页面有非常大的不同，在页面里边我们直接写在`Page({})`的选项对象里边就好了

组件的生命周期一共有三个：

1. `created` ： 组件实例刚刚被创建好。**此时还不能调用 `setData`** -> 用的很少，因为无法调用`setData`，不要跟 Vue 的`created`给混淆了
2. `attached`：组件完全初始化完毕、进入页面节点树后才进行调用。**绝大多数初始化工作可以在这个时机进行** -> 用的最多
3. `detached`：在组件离开页面节点树后才进行调用

💡：实现需求

步骤：

1. 定位到组件的`js`文件，在`Component({})`的`{}`里边添加一个`lifetimes`属性，它是一个列表对象，在这里对象里边添加生命周期函数`attached`
2. 在`methods`里边添加`loadTabsData`方法，用来发送请求获取数据 -> 把获取到的数据赋值给`data`旗下的`listData`
3. 根据`listData`渲染视图 -> 添加相应样式 -> 处理默认选中 -> 添加一个`active`数据

代码：

`tabs.js`：

``` js
// components/tabs/tabs.js
Component({
  /**
   * 组件的属性列表
   */
  properties: {

  },

  /**
   * 组件的初始数据
   */
  data: {
    // 数据源
    listData: [],
    // 选中项
    active: -1
  },

  /**
   * 组件的方法列表（组件中的方法必须定义到 methods 中）
   */
  methods: {
    /**
     * 获取数据的方法
     */
    loadTabsData() {
      wx.request({
        url: 'https://api.imooc-blog.lgdsunday.club/api/hot/tabs',
        success: (res) => {
          console.log(res)
          this.setData({
            listData: res.data.data.list,
            active: 0
          })
        }
      })
    }
  },
  /**
   * 生命周期函数
   */
  lifetimes: {
    attached() {
      this.loadTabsData()
    }
  }
})
```

请求结果：

![请求](assets/img/2021-12-13-23-09-25.png)

渲染情况：

![效果](assets/img/2021-12-13-23-03-09.png)

4、答案

> 1. 组件的 **生命周期** 和 **方法** 分别应该被放入到哪个节点下？
>    1. 生命周期应该被定义在 `lifetimes` 这个选项中
>    2. 方法必须要放入到 `methods` 这个节点中
> 2. `created` 函数中可以调用 `setData` 吗？
>    1. 不可以
> 3. 获取数据的操作应该在哪个函数中进行？ -> 主要有 3 个生命周期函数
>    1. `attached` -> 我们的大部分操作一般都这个函数中进行

5）数据监听器

